generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int         @id @default(autoincrement())
  email      String      @unique
  name       String?
  password   String
  role       Role        @default(Employee)
  quotations Quotation[]
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  status     UserStatus  @default(ACTIVE)
}

model Quotation {
  id          String @id @default(uuid())
  quotationNo String @unique

  clientName      String?
  clientEmail     String?
  clientPhone     String?
  clientAddress   String?
  travelDate      DateTime
  groupSize       Int
  destinationName String?
  totalNights     Int      @default(0)

  flightCostPerPerson Float?
  landCostPerPerson   Float?
  totalCostPerPerson  Float?
  totalGroupCost      Float?

  flightRoute    String?
  flightImageUrl String?

  mealPlanName String?
  notes        String?

  packageId     Int?
  package       Package?     @relation(fields: [packageId], references: [id])
  destinationId Int?
  destination   Destination? @relation(fields: [destinationId], references: [id])

  createdBy   User            @relation(fields: [createdById], references: [id])
  createdById Int
  status      QuotationStatus @default(DRAFT)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  mealPlanId Int?

  accommodations QuotationAccommodation[]
  transfers      QuotationTransfer[]
  itinerary      QuotationItinerary[]
  inclusions     QuotationInclusion[]
  exclusions     QuotationExclusion[]
}

model QuotationAccommodation {
  id          Int       @id @default(autoincrement())
  quotation   Quotation @relation(fields: [quotationId], references: [id], onDelete: Cascade)
  quotationId String

  location  String // e.g., "Leh"
  hotelName String // e.g., "The Grand Dragon"
  roomType  String // e.g., "Deluxe Room"
  nights    Int
  price     Float // Price per night AT THE TIME OF QUOTING
}

model QuotationTransfer {
  id          Int       @id @default(autoincrement())
  quotation   Quotation @relation(fields: [quotationId], references: [id], onDelete: Cascade)
  quotationId String

  type        String // "Intercity" or "Local Sightseeing"
  vehicleName String // "Toyota Innova"
  price       Float // Price for this transfer AT THE TIME OF QUOTING
}

model QuotationItinerary {
  id          Int       @id @default(autoincrement())
  quotation   Quotation @relation(fields: [quotationId], references: [id], onDelete: Cascade)
  quotationId String
  dayTitle    String
  description String
}

model QuotationInclusion {
  id          Int       @id @default(autoincrement())
  quotation   Quotation @relation(fields: [quotationId], references: [id], onDelete: Cascade)
  quotationId String
  item        String
}

model QuotationExclusion {
  id          Int       @id @default(autoincrement())
  quotation   Quotation @relation(fields: [quotationId], references: [id], onDelete: Cascade)
  quotationId String
  item        String
}

// model Accommodation {
//   id          Int       @id @default(autoincrement())
//   location    String
//   hotelName   String
//   nights      Int
//   quotation   Quotation @relation(fields: [quotationId], references: [id])
//   quotationId String

//   hotelId Int?
//   hotel   Hotel? @relation(fields: [hotelId], references: [id])
// }

// model ItineraryItem {
//   id          Int       @id @default(autoincrement())
//   dayTitle    String
//   description String
//   quotation   Quotation @relation(fields: [quotationId], references: [id])
//   quotationId String
// }

enum Role {
  Employee
  Admin
}

enum QuotationStatus {
  DRAFT
  SENT
  ACCEPTED
  REJECTED
  CANCELLED
}

enum ServiceType {
  HOTEL
  FLIGHT
  TOUR
  INSURANCE
  VEHICLE
  PACKAGE
  MEAL
  OTHER
}

enum UserStatus {
  ACTIVE
  LOCKED
  SUSPENDED
  INACTIVE
}

model Destination {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  state       String?
  countryId   Int?
  country     Country? @relation(fields: [countryId], references: [id])
  description String?
  imageUrl    String?

  packages   Package[]
  quotations Quotation[]
  hotels     Hotel[]
}

model Hotel {
  id                Int          @id @default(autoincrement())
  name              String
  starRating        Int?
  amenities         String?
  mealPlan          String?      @default("No")
  source            String?
  countryId         Int?
  country           Country?     @relation(fields: [countryId], references: [id])
  destinationId     Int?
  destination       Destination? @relation(fields: [destinationId], references: [id])
  basePricePerNight Float?

  rateCards HotelRateCard[]
  // Accommodation Accommodation[]
}

model HotelRateCard {
  id       Int    @id @default(autoincrement())
  hotel    Hotel  @relation(fields: [hotelId], references: [id])
  hotelId  Int
  roomType String
  season   String
  rate     Float
}

model Transfer {
  id         Int      @id @default(autoincrement())
  type       String
  priceInINR Float
  countryId  Int
  country    Country  @relation(fields: [countryId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // intercityVehicleQuotations Quotation[] @relation("IntercityVehicle")
  // localVehicleQuotations     Quotation[] @relation("LocalVehicle")
}

model MealPlan {
  id            Int     @id @default(autoincrement())
  name          String  @unique
  description   String?
  ratePerPerson Float
  countryId     Int
  country       Country @relation(fields: [countryId], references: [id])

  // quotations Quotation[]
}

model Package {
  id                 Int     @id @default(autoincrement())
  name               String
  description        String?
  durationDays       Int
  basePricePerPerson Float
  totalNights        Int

  packageItineraries PackageItinerary[]
  quotations         Quotation[]
  Destination        Destination?       @relation(fields: [destinationId], references: [id])
  destinationId      Int?
}

model PackageItinerary {
  id          Int     @id @default(autoincrement())
  package     Package @relation(fields: [packageId], references: [id])
  packageId   Int
  dayNumber   Int
  title       String
  description String
}

model MarkupRule {
  id          Int         @id @default(autoincrement())
  serviceType ServiceType
  percentage  Float
}

model Activity {
  id               Int      @id @default(autoincrement())
  name             String
  transfer         String?
  ticketPriceAdult Float
  ticketPriceChild Float?
  countryId        Int
  country          Country  @relation(fields: [countryId], references: [id])
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Country {
  id                Int               @id @default(autoincrement())
  code              String            @unique
  name              String
  flag              String
  currency          String
  destinations      Destination[]
  countryCurrencies CountryCurrency[]
  hotels            Hotel[]
  transfers         Transfer[]
  activities        Activity[]
  mealPlans         MealPlan[]
  airports          Airport[]
}

model CountryCurrency {
  id             Int      @id @default(autoincrement())
  countryId      Int
  currencyCode   String
  conversionRate Float
  baseCurrency   String
  targetCurrency String
  updatedAt      DateTime @updatedAt

  country Country @relation(fields: [countryId], references: [id])

  @@unique([countryId, currencyCode])
}

model Airport {
  id        Int      @id @default(autoincrement())
  name      String
  code      String   @unique
  city      String
  country   Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
  countryId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
